<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--  <head>-->
<!--    <meta charset="UTF-8">-->
<!--    <title>Processor Visualiser</title>-->
<!--    <link rel="stylesheet" href="proc_vis.css">-->
<!--  </head>-->
<!--  <body>-->
    <link rel="stylesheet" href="proc_vis.css">
    <div class="box">
      <svg id="cpu-svg" xmlns="http://www.w3.org/2000/svg" width="900px" height="695px">
        <g transform="translate(10,10)">

          <g transform="translate(175,150)">
            <path id="data-line7" class="line data"
                  d="m 0 -14 h 61 v -61 v 150 v -89 h 125 v -61 v 150 v -89 h 289 h -164 v 325 h 89 h -276.5 v -61 v 61 h -123.5"/>
            <path id="data-line6" class="line data"
                  d="m 0 -10 h 65 v -65 v 150 v -85 h 125 v -65 v 150 v -85 h 285 h -160 v 325 h 85 h -272.5 v -65 v 65 h -127.5"/>
            <path id="data-line5" class="line data"
                  d="m 0 -6  h 69 v -69 v 150 v -81 h 125 v -69 v 150 v -81 h 281 h -156 v 325 h 81 h -268.5 v -69 v 69 h -131.5"/>
            <path id="data-line4" class="line data"
                  d="m 0 -2  h 73 v -73 v 150 v -77 h 125 v -73 v 150 v -77 h 277 h -152 v 325 h 77 h -264.5 v -73 v 73 h -135.5"/>
            <path id="data-line3" class="line data"
                  d="m 0  2  h 77 v -77 v 150 v -73 h 125 v -77 v 150 v -73 h 273 h -148 v 325 h 73 h -260.5 v -77 v 77 h -139.5"/>
            <path id="data-line2" class="line data"
                  d="m 0  6  h 81 v -81 v 150 v -69 h 125 v -81 v 150 v -69 h 269 h -144 v 325 h 69 h -256.5 v -81 v 81 h -143.5"/>
            <path id="data-line1" class="line data"
                  d="m 0  10 h 85 v -85 v 150 v -65 h 125 v -85 v 150 v -65 h 265 h -140 v 325 h 65 h -252.5 v -85 v 85 h -147.5"/>
            <path id="data-line0" class="line data"
                  d="m 0  14 h 89 v -89 v 150 v -61 h 125 v -89 v 150 v -61 h 261 h -136 v 325 h 61 h -248.5 v -89 v 89 h -151.5"/>
          </g>
          <!--        Decoder -->
          <g transform="translate(0,0)">
            <g transform="translate(100,125)">
              <polyline id="ins-ctrl-s" class="line control" points="0,0 25,0"/>
            </g>
            <g transform="translate(100,150)">
              <polyline id="ins-line7" class="line data" points="0,-14 25,-14"/>
              <polyline id="ins-line6" class="line data" points="0,-10 25,-10"/>
              <polyline id="ins-line5" class="line data" points="0,-6 25,-6"/>
              <polyline id="ins-line4" class="line data" points="0,-2 25,-2"/>
              <polyline id="ins-line3" class="line data" points="0,2 25,2"/>
              <polyline id="ins-line2" class="line data" points="0,6 25,6"/>
              <polyline id="ins-line1" class="line data" points="0,10 25,10"/>
              <polyline id="ins-line0" class="line data" points="0,14 25,14"/>
              <g transform="translate(25,-50)" id="g-reg-ins" class="g-reg">
                <rect id="svg-reg-ins" class="register" height="100px" width="50px"/>
                <text class="label small" y="22.5" x="2" rotate="90">S</text>
                <text id="ins-value" class="label" x="50" y="-25" transform="rotate(90)" text-anchor="middle"
                      alignment-baseline="central">00000000
                </text>
                <text class="label small" x="50" y="-40" text-anchor="middle" transform="rotate(90)">Instruction Register</text>
              </g>
            </g>

            <g transform="translate(100,450)">
              <polyline id="pc-ctrl-s" class="line control" points="0,-4 25,-4"/>
              <polyline id="pc-ctrl-e" class="line control" points="0,0 25,0"/>
              <polyline id="pc-ctrl-i" class="line control" points="0,4 25,4"/>
              <g transform="translate(25,-25)" id="g-reg-pc" class="g-reg">
                <rect id="svg-reg-pc" class="register" height="100px" width="50px"/>
                <text class="label small" x="2" y="17" rotate="90">S</text>
                <text class="label small" x="2" y="23" rotate="90">E</text>
                <text class="label small" x="2" y="29" rotate="90">I</text>
                <text id="pc-value" class="label" x="50" y="-25" transform="rotate(90)" text-anchor="middle"
                      alignment-baseline="central">00000000
                </text>
                <text class="label small" x="50" y="-40" text-anchor="middle" transform="rotate(90)">Program Counter</text>
              </g>
            </g>

            <g transform="translate(100,350)">
              <path id="alu-ctrl-2" class="line control" d="m 0 -12 h 200"/>
              <path id="alu-ctrl-1" class="line control" d="m 0 -8 h 200"/>
              <path id="alu-ctrl-0" class="line control" d="m 0 -4 h 200"/>

              <path id="flgs-1" class="line data" d="m 0 12 h 200"/>
              <path id="flgs-0" class="line data" d="m 0 20 h 200"/>
            </g>

            <g transform="translate(100,212.5)">
              <path id="t1-ctrl-s" class="line control" d="m 0 2 h 125 v 10.5"/>
              <path id="t2-ctrl-s" class="line control" d="m 0 -2 h 250 v 14.5"/>
            </g>

            <g transform="translate(100,87.5)">
              <path id="a-ctrl-s" class="line control" d="m 0 -6 h 123 v -6.5"/>
              <path id="a-ctrl-e" class="line control" d="m 0 -2 h 127 v -10.5"/>
            </g>

            <g transform="translate(100,87.5)">
              <path id="b-ctrl-s" class="line control" d="m 0 2 h 248 v -14.5"/>
              <path id="b-ctrl-e" class="line control" d="m 0 6 h 252 v -18.5"/>
            </g>

            <g transform="translate(100,550)">
              <path id="addr-ctrl-s" class="line control" d="m 0 -6 h 425 v -44 h 50"/>
            </g>
            <g transform="translate(100,550)">
              <path id="ram-ctrl-s" class="line control" d="m 0 -2 h 550"/>
              <path id="ram-ctrl-e" class="line control" d="m 0 2 h 550"/>
            </g>
            <rect id="svg-decoder" class="decoder" height="575px" width="100px"/>

            <g transform="translate(55,287.5) rotate(-90)">
              <text class="label large" text-anchor="middle">Control Unit</text>
              <text class="label" id="control-step" text-anchor="middle" y="16pt">Foo Bar</text>
            </g>
          </g>

          <g transform="translate(200,25)" id="g-reg-a" class="g-reg">
            <rect id="svg-reg-a" class="register" height="50px" width="100px"/>
            <text class="label small" x="19" y="48">S</text>
            <text class="label small" x="25" y="48">E</text>
            <text id="a-value" class="label" x="50" y="25" text-anchor="middle" alignment-baseline="central">00000000
            </text>
            <text class="label small" x="50" y="10" text-anchor="middle" transform="">General Register A</text>
          </g>
          <!--        <rect id="svg-reg-a" class="register" height="50px" width="100px" x="200px" y="25px"/>-->

          <g transform="translate(325,25)" id="g-reg-b" class="g-reg">
            <rect id="svg-reg-b" class="register" height="50px" width="100px"/>
            <text class="label small" x="19" y="48">S</text>
            <text class="label small" x="25" y="48">E</text>
            <text id="b-value" class="label" x="50" y="25" text-anchor="middle" alignment-baseline="central">00000000
            </text>
            <text class="label small" x="50" y="10" text-anchor="middle" transform="">General Register B</text>
          </g>
          <!--        <rect id="svg-reg-b" class="register" height="50px" width="100px" x="325px" y="25px"/>-->


          <!--        ALU-->
          <g transform="translate(200,200)">
            <g transform="translate(50,75)">
              <path id="t1-line7" class="line data" d="m -14 0 v 25"/>
              <path id="t1-line6" class="line data" d="m -10 0 v 25"/>
              <path id="t1-line5" class="line data" d="m  -6 0 v 25"/>
              <path id="t1-line4" class="line data" d="m  -2 0 v 25"/>
              <path id="t1-line3" class="line data" d="m   2 0 v 25"/>
              <path id="t1-line2" class="line data" d="m   6 0 v 25"/>
              <path id="t1-line1" class="line data" d="m  10 0 v 25"/>
              <path id="t1-line0" class="line data" d="m  14 0 v 25"/>
            </g>
            <g transform="translate(175,75)">
              <path id="t2-line7" class="line data" d="m -14 0 v 25"/>
              <path id="t2-line6" class="line data" d="m -10 0 v 25"/>
              <path id="t2-line5" class="line data" d="m  -6 0 v 25"/>
              <path id="t2-line4" class="line data" d="m  -2 0 v 25"/>
              <path id="t2-line3" class="line data" d="m   2 0 v 25"/>
              <path id="t2-line2" class="line data" d="m   6 0 v 25"/>
              <path id="t2-line1" class="line data" d="m  10 0 v 25"/>
              <path id="t2-line0" class="line data" d="m  14 0 v 25"/>
            </g>

            <g transform="translate(0,25)" id="g-reg-t1" class="g-reg">
              <rect id="svg-reg-t1" class="register" height="50px" width="100px"/>
              <text class="label small" x="22" y="9">S</text>
              <text id="t1-value" class="label" x="50" y="25" text-anchor="middle" alignment-baseline="central">
                00000000
              </text>
              <text class="label small" x="50" y="40" text-anchor="middle" transform="">Math Register T1</text>
            </g>
            <!--          <rect id="svg-reg-t1" class="register" height="50px" width="100px" x="0" y="25px"/>-->
            <g transform="translate(125,25)" id="g-reg-t2" class="g-reg">
              <rect id="svg-reg-t2" class="register" height="50px" width="100px"/>
              <text class="label small" x="22" y="9">S</text>
              <text id="t2-value" class="label" x="50" y="25" text-anchor="middle" alignment-baseline="central">
                00000000
              </text>
              <text class="label small" x="50" y="40" text-anchor="middle" transform="">Math Register T2</text>
            </g>
            <!--          <rect id="svg-reg-t2" class="register" height="50px" width="100px" x="125" y="25px"/>-->
            <g transform="translate(0, 100)">
              <path id="svg-alu" class="alu" d="M 50 0
              h 45.8578643763
              a 10 10 0 0 1 7.071067811865 2.928932188112
              L 112.5 12.5
              l 9.571067811865 -9.571067811865
              A 10 10 0 0 1 129.1421356237 0
              H 206.9575235849
              A 10 10 0 0 1 215.4375066249 15.2999894
              L 165.4375066249 95.2999894
              A 10 10 0 0 1 156.9575235849 100
              H 68.04247642507
              A 10 10 0 0 1 59.562493375 95.2999894
              L 9.5624933751 15.2999894
              A 10 10 0 0 1 18.0424764151 0 z"/>

              <text class="label large" text-anchor="middle" x="112.5" y="55">ALU</text>
            </g>
          </g>

          <g transform="translate(575,0)">
            <g transform="translate(50,475)">
              <path id="addr-line7" class="line address" d="m 0 -14 h 25"/>
              <path id="addr-line6" class="line address" d="m 0 -10 h 25"/>
              <path id="addr-line5" class="line address" d="m 0 -6 h 25"/>
              <path id="addr-line4" class="line address" d="m 0 -2 h 25"/>
              <path id="addr-line3" class="line address" d="m 0 2 h 25"/>
              <path id="addr-line2" class="line address" d="m 0 6 h 25"/>
              <path id="addr-line1" class="line address" d="m 0 10 h 25"/>
              <path id="addr-line0" class="line address" d="m 0 14 h 25"/>
            </g>

            <g transform="translate(0,425)" id="g-reg-addr" class="g-reg">
              <rect id="svg-reg-addr" class="register" height="100px" width="50px"/>
              <text class="label small" x="2" y="72" rotate="90">S</text>
              <text id="addr-value" class="label" x="50" y="-25" transform="rotate(90)" text-anchor="middle"
                    alignment-baseline="central">00000000
              </text>
              <text class="label small" x="50" y="-40" text-anchor="middle" transform="rotate(90)">Address Register</text>
            </g>
            <!--          <rect id="svg-reg-adr" class="register" height="100px" width="50px" y="425px"/>-->
            <rect id="svg-ram" class="ram" height="575px" width="230px" x="75px"/>
            <line class="ram" x1="75px" x2="305px" y1="45px" y2="45px"/>
            <g transform="translate(77,544)">
              <text class="label small" y="0" rotate="90">S</text>
              <text class="label small" y="6" rotate="90">E</text>
            </g>
            <text class="label large" x="190px" y="35px" text-anchor="middle">RAM</text>
          </g>
          <g transform="translate(235,340) rotate(57.995)">
            <text class="label small" text-anchor="middle" alignment-baseline="central">Op Code</text>
          </g>
          <g transform="translate(97,362)">
            <text class="label small" text-anchor="end" alignment-baseline="central" y="0">Zero</text>
            <text class="label small" text-anchor="end" alignment-baseline="central" y="8">Sign</text>
          </g>
          <g transform="translate(0,575)"> <!-- Clock -->
            <path id="clock-line" d="m 50 0 v 25" class="line data"/>
            <rect y="25" height="75" width="500" class="decoder" />
            <text x="20" y="62.5" class="label large" alignment-baseline="central">Clock</text>
            <g id="clock-loop" class="button" onclick="onButtonPress('loop')" transform="translate(125,37.5)">
              <circle class="clock-button" r="25" cx="25" cy="25"/>
              <polygon class="register" points="30 25, 15 33.6602540378, 15 16.3397459622"/>
              <polygon class="register" points="40 25, 25 33.6602540378, 25 16.3397459622"/>
            </g>
            <g id="clock-instruction" class="button" onclick="onButtonPress('instruction')" transform="translate(200,37.5)">
              <circle class="clock-button" r="25" cx="25" cy="25"/>
              <polygon class="register" points="35 25, 20 33.6602540378, 20 16.3397459622"/>
            </g>
            <g id="clock-step" class="button" onclick="onButtonPress('step')" transform="translate(275,37.5) ">
              <circle class="clock-button" r="25" cx="25" cy="25"/>
              <polygon class="register" points="30 25, 15 33.6602540378, 15 16.3397459622"/>
              <polygon class="register" points="30 16.3397459622, 35 16.3397459622, 35 33.6602540378, 30 33.6602540378"/>
            </g>
            <g id="clock-delay" transform="translate(345,45)">
              <text class="label" style="font-size: small">Clock Delay (ms)</text>
            </g>
          </g>

          <g id="bttn-reset" class="button" onclick="sim.reset(); sim.update_display()" transform="translate(650,600)">
            <rect height="75" width="230" class="register reset-button"/>
            <text class="label large" text-anchor="middle" x="115" y="45">Reset</text>
          </g>
        </g>
      </svg>
      <div class="ram input">
        <table id="ram-table"></table>
      </div>
      <div class="clock-settings">
        <input id="clock-time" type="number"  value="250"/>
      </div>
      <script src="./proc_sim.js"></script>
      <script src="./sim_ui.js"></script>
    </div>
    <div class="instructions">

      <div class="tab">
        <button class="tablinks active" onclick="openTab(this, 'overview')">Overview</button>
        <button class="tablinks" onclick="openTab(this, 'isa')">Instruction Set</button>
        <button class="tablinks" onclick="openTab(this, 'feedback')">Feedback</button>
      </div>

      <div id="overview" class="tabcontent active">
        Hello!<br>
        <p>Welcome to ProcVis, a program to help visualise how processors work</p>
        <p>The interactive diagram above shows a very simple computer architecture.</p>
        <p>
          The small rectangles are registers, these all store an eight digit (eight bit) binary number.
          The value they are storing at any time is written on them.
          Each register has up to three control inputs labeled 'S', 'E', and 'I' for Set, Enable, and Increment
          respectively.
          When a register has the 'Set' control active it will store the value currently on the data-bus.
          The 'Enable' control does the opposite, making the register put its value onto the data-bus.
          Finally, the 'Increment' control is only used by the program counter and causes it to increment (add 1 to)
          its stored value.
        </p>
        <p>
          The large rectangle on the left, labeled Control Unit (CU), is responsible for decoding the instructions and
          sending signals to the other components telling them what to do each clock cycle. This includes sending the
          Set/Enable signals for the registers and ram, and the op-codes for the ALU.
        </p>
        <p>
          The odd shaped block in the middle labeled ALU is the "Arithmetic and Logic Unit". This is responsible for
          performing any calculations wanted by the program. When given an op-code on its three control lines from the
          CU, the ALU takes the values stored in registers T1 and T2, performs the corresponding calculation with them,
          and outputs the result onto the data-bus. There are four extra lines going from the ALU into the Control Unit
          which carry some extra data about the output. These are called the "Flags", and show if the maths resulted in
          a value of <span style="text-decoration: underline">Z</span>ero, the
          <span style="text-decoration: underline">S</span>ign bit was high (i.e. the result is less than zero),
          if there was a potential <span style="text-decoration: underline">O</span>verflow (e.g. two positive numbers
          added resulted in a negative), and if the
          <span style="text-decoration: underline">C</span>arry of the output was high (e.g. addition of unsigned
          numbers was greater than eight bits).
        </p>
        <p>
          The large block on the right is computer's memory, called Random Access Memory or RAM as we are able to access
          any part of it at all times. This memory can be read or written to using the data-bus and Set/Enable control
          lines. To control where we write to in the memory we set an address in the address register, which tells the
          RAM where we would like to read from or write to. As with the registers, when the 'Set' control is active the
          memory at the specified address is set to the value on the data-bus, and with the 'Enable' control the value
          at the address is written to the data-bus.
        </p>
        <hr/>
        <p>
          The computer is initially loaded with a program that performs the multiplication 3&times;5 and stores the result at
          address 0x03 before entering an infinite loop.
          To see how this works use the buttons on the Clock. Fast-forward through to run through the entire program
          without stopping, use play to run through to the next instruction, or use the step button to advance one clock
          cycle at a time.
          To change the numbers being multiplied, change the value in 0x02 (initially 3) and 0x05 (initially 5).
          Make sure to reset the program beforehand by refreshing the page!
        </p>
        <p>
          If you wish to play around further, the contents of the RAM can be edited by typing new values into each
          address. You can cycle the display mode between text, signed decimal, hexadecimal, and binary by clicking the
          address number.
        </p>
        <p>
          When running, components will light up <span class="register read">Red</span> when being read from and
          <span class="register write">Blue</span> when being written to. The bus lines will change from
          <span class="line data">blue</span> to <span class="line data high">yellow</span> when active for the data-bus
          and from <span class="line control">red</span> to <span class="line control high">cyan</span> for control
          lines.
        </p>

      </div>
      <div id="isa" class="tabcontent">

        The shown "computer" uses an eight bit architecture, with the following instructions:<br>
        Operands to the instruction are in the form $i and $r. $r must be either 'a' or 'b' referring to general use
        registers a and b. $i can be 'a', 'b' or 'i' indicating to use instead the value immediately following the
        instruction.
        <ul>
          <li>
            Maths:
            <ul>
              <li><span class="mono">add $i<sub>1</sub> $i<sub>2</sub> $r</span> &rightarrow; set $r to $i<sub>1</sub> + $i<sub>2</sub></li>
              <li><span class="mono">sub $i<sub>1</sub> $i<sub>2</sub> $r</span> &rightarrow; set $r to $i<sub>1</sub> - $i<sub>2</sub></li>
              <li><span class="mono">and $i<sub>1</sub> $i<sub>2</sub> $r</span> &rightarrow; set $r to $i<sub>1</sub> bitwise and with $i<sub>2</sub></li>
              <li><span class="mono">ior $i<sub>1</sub> $i<sub>2</sub> $r</span> &rightarrow; set $r to $i<sub>1</sub> bitwise inclusive or with $i<sub>2</sub></li>
              <li><span class="mono">xor $i<sub>1</sub> $i<sub>2</sub> $r</span> &rightarrow; set $r to $i<sub>1</sub> bitwise exclusive or with $i<sub>2</sub></li>
              <li><span class="mono">not $i $r</span> &rightarrow; set $r to the bitwise negation of $i</li>
            </ul>
          </li>
          <li>
            Memory:
            <ul>
              <li><span class="mono">save $r<sub>1</sub> $r<sub>2</sub></span> &rightarrow; saves the value in $r<sub>1</sub> at $r<sub>2</sub></li>
              <li><span class="mono">load $i $r</span> &rightarrow; loads the value/value at $i into $r</li>
            </ul>
            It should be noted that for load operations with an immediate value the value itself is loaded, not the
            value at the following address. This is because the ram cannot write to the address register without
            changing the address being read. Therefor to load an instruction from a different address two instructions
            are needed 1) load the address you intend to read into a register 2) load the address indicated by that
            register. The same is true for save operations, meaning that the address being saved to always needs to be
            loaded into a register before save operations. In practice this looks like:
            "<span class="mono">load i a; 0x$$; load a a</span>" to
            load a value at an address into a and "<span class="mono">load i a; 0x$$; save b a</span>" to save b at an
            address.
          </li>
          <li>
            Jumps:
            <ul>
              <li><span class="mono">jmp $i</span> &rightarrow; goto $i</li>
              <li><span class="mono">jlz $i</span> &rightarrow; goto $i if the last maths operation gave a signed value less than 0</li>
              <li><span class="mono">jgz $i</span> &rightarrow; goto $i if the last maths operation gave a signed value greater than 0</li>
              <li><span class="mono">jez $i</span> &rightarrow; goto $i is the last maths operation gave a value of zero</li>
            </ul>
          </li>
        </ul>
        For convenience, when typing instructions immediate values can be given in-line
        (e.g. <span class="mono">add a 1 a</span>) and will be converted to the actual instructions on assembly
        (e.g. <span class="mono">add a i a; 1</span>).
      </div>
      <div id="feedback" class="tabcontent">
        <p>
          If you have any feedback about this please email
          <a href="mailto:benjft.procvis@gmail.com">benjft.procvis@gmail.com</a>.
        </p>
        <p>
          You can also <a href="https://github.com/benjft/ProcVis/issues/new">create a post here</a> if you find any
          bugs/issues with the program.
        </p>
<!--        <p>-->
<!--          Finally, if you want to help me gather data, compete the quiz here:-->
<!--        </p>-->
      </div>

    </div>
<!--  </body>-->
<!--</html>-->